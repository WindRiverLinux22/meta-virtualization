From aa4136b6afcf3388ab19018b4910b711532fc449 Mon Sep 17 00:00:00 2001
From: Aditya R <arajan@redhat.com>
Date: Fri, 21 Oct 2022 15:50:13 +0800
Subject: [PATCH] vendor: bump buildah to v1.27.1

Podman build: Add container GID to additional groups

CVE: CVE-2022-2989
Upstream-Status: Backport[https://github.com/containers/podman/pull/15715/commits/49125dccb5c1d17139f2fac76753365093db5581]

Signed-off-by: Aditya R <arajan@redhat.com>
Signed-off-by: Mingli Yu <mingli.yu@windriver.com>
---
 go.mod                                               | 2 +-
 go.sum                                               | 4 ++--
 vendor/github.com/containers/buildah/define/types.go | 2 +-
 vendor/github.com/containers/buildah/run_linux.go    | 1 +
 vendor/modules.txt                                   | 2 +-
 5 files changed, 6 insertions(+), 5 deletions(-)

diff --git a/src/import/go.mod b/src/import/go.mod
index 24be69d4e..cc6559ea1 100644
--- a/src/import/go.mod
+++ b/src/import/go.mod
@@ -11,7 +11,7 @@ require (
 	github.com/container-orchestrated-devices/container-device-interface v0.0.0-20220111162300-46367ec063fd
 	github.com/containernetworking/cni v1.0.1
 	github.com/containernetworking/plugins v1.0.1
-	github.com/containers/buildah v1.24.3
+	github.com/containers/buildah v1.27.1
 	github.com/containers/common v0.47.5
 	github.com/containers/conmon v2.0.20+incompatible
 	github.com/containers/image/v5 v5.19.2
diff --git a/src/import/go.sum b/src/import/go.sum
index 7ae34cf4a..de9fb3f8a 100644
--- a/src/import/go.sum
+++ b/src/import/go.sum
@@ -324,8 +324,8 @@ github.com/containernetworking/plugins v0.8.6/go.mod h1:qnw5mN19D8fIwkqW7oHHYDHV
 github.com/containernetworking/plugins v0.9.1/go.mod h1:xP/idU2ldlzN6m4p5LmGiwRDjeJr6FLK6vuiUwoH7P8=
 github.com/containernetworking/plugins v1.0.1 h1:wwCfYbTCj5FC0EJgyzyjTXmqysOiJE9r712Z+2KVZAk=
 github.com/containernetworking/plugins v1.0.1/go.mod h1:QHCfGpaTwYTbbH+nZXKVTxNBDZcxSOplJT5ico8/FLE=
-github.com/containers/buildah v1.24.3 h1:HKzNmbcLEHY88nJV0WtZ8vzKBACflKPjR8RE/2xjYoI=
-github.com/containers/buildah v1.24.3/go.mod h1:qU6SSznCzbRS3SVllEYoMUMW8kqxAqsggscCMctwfL8=
+github.com/containers/buildah v1.27.1 h1:i5yP3uJBq9mKANOP4WA+5x9cBuEQ4FJIAzEPoPzRrXQ=
+github.com/containers/buildah v1.27.1/go.mod h1:anH3ExvDXRNP9zLQCrOc1vWb5CrhqLF/aYFim4tslvA=
 github.com/containers/common v0.47.5 h1:Qm9o+wVPO9sbggTKubN3xYMtPRaPv7dmcrJQgongHHw=
 github.com/containers/common v0.47.5/go.mod h1:HgX0mFXyB0Tbe2REEIp9x9CxET6iSzmHfwR6S/t2LZc=
 github.com/containers/conmon v2.0.20+incompatible h1:YbCVSFSCqFjjVwHTPINGdMX1F6JXHGTUje2ZYobNrkg=
diff --git a/src/import/vendor/github.com/containers/buildah/define/types.go b/src/import/vendor/github.com/containers/buildah/define/types.go
index 447d01aa7..97b320356 100644
--- a/src/import/vendor/github.com/containers/buildah/define/types.go
+++ b/src/import/vendor/github.com/containers/buildah/define/types.go
@@ -29,7 +29,7 @@ const (
 	Package = "buildah"
 	// Version for the Package.  Bump version in contrib/rpm/buildah.spec
 	// too.
-	Version = "1.24.3"
+	Version = "1.27.1"
 
 	// DefaultRuntime if containers.conf fails.
 	DefaultRuntime = "runc"
diff --git a/src/import/vendor/github.com/containers/buildah/run_linux.go b/src/import/vendor/github.com/containers/buildah/run_linux.go
index eb9adbfb6..af9df8081 100644
--- a/src/import/vendor/github.com/containers/buildah/run_linux.go
+++ b/src/import/vendor/github.com/containers/buildah/run_linux.go
@@ -2084,6 +2084,7 @@ func (b *Builder) configureUIDGID(g *generate.Generator, mountPoint string, opti
 	}
 	g.SetProcessUID(user.UID)
 	g.SetProcessGID(user.GID)
+	g.AddProcessAdditionalGid(user.GID)
 	for _, gid := range user.AdditionalGids {
 		g.AddProcessAdditionalGid(gid)
 	}
diff --git a/src/import/vendor/modules.txt b/src/import/vendor/modules.txt
index 490119814..3972ccbb6 100644
--- a/src/import/vendor/modules.txt
+++ b/src/import/vendor/modules.txt
@@ -87,7 +87,7 @@ github.com/containernetworking/cni/pkg/version
 # github.com/containernetworking/plugins v1.0.1
 ## explicit
 github.com/containernetworking/plugins/pkg/ns
-# github.com/containers/buildah v1.24.3
+# github.com/containers/buildah v1.27.1
 ## explicit
 github.com/containers/buildah
 github.com/containers/buildah/bind
-- 
2.25.1

